---
import type { Agent } from '../agents/featureSetSchema';
import { ParsedTable } from '../agents/parsedTable';
import CategoryRow from './CategoryRow.astro';

interface Props {
  agents: Agent[];
}

const { agents } = Astro.props;

// Create parsed table from agents
const parsedTable = new ParsedTable(agents);
const features = parsedTable.getFeatures();
---

<div class="table-card">
  <table>
    <thead>
      <tr>
        <th class="feature-col">Feature</th>
        {agents.map((agent) => (
          <th class="agent-col">{agent.meta.name}</th>
        ))}
      </tr>
    </thead>
    <tbody>
      {features.map((feature) => (
        <CategoryRow
          feature={feature}
          agents={agents}
        />
      ))}
    </tbody>
  </table>
</div>

<style>
  /* Table Card */
  .table-card {
    background-color: var(--bg-card);
    border-radius: 16px;
    box-shadow: 
      0 1px 3px rgba(0, 0, 0, 0.04),
      0 4px 12px rgba(0, 0, 0, 0.06);
    overflow: hidden;
    margin-top: 1rem;
  }

  /* Table */
  table {
    width: 100%;
    border-collapse: collapse;
  }

  thead tr {
    border-bottom: 1px solid var(--border-light);
  }

  th {
    padding: 1rem 1.25rem;
    text-align: left;
    font-weight: 500;
    font-size: 0.9rem;
    color: var(--text-secondary);
  }

  th.feature-col {
    width: 280px;
    font-weight: 600;
  }

  th.agent-col {
    text-align: center;
    min-width: 100px;
  }

  /* Table body - borders only between categories */
  tbody tr {
    border-bottom: none;
  }

  /* Add border before category rows (acts as separator between category groups) */
  .category-row {
    border-top: 1px solid var(--border-light);
  }

  /* First category row doesn't need top border */
  tbody tr:first-child.category-row {
    border-top: none;
  }

  /* Last row in table gets bottom border for visual closure */
  tbody tr:last-child {
    border-bottom: none;
  }

  td {
    padding: 0.875rem 1.25rem;
    vertical-align: middle;
  }

  /* Responsive */
  @media (max-width: 900px) {
    .table-card {
      border-radius: 12px;
    }
    
    th, td {
      padding: 0.75rem 0.75rem;
    }
    
    .category-row td {
      padding: 0.9rem 0.75rem;
    }
    
    .feature-row td {
      padding: 0.4rem 0.75rem;
    }
    
    th.feature-col {
      width: 180px;
    }
  }

  @media (max-width: 600px) {
    .table-card {
      overflow-x: auto;
    }
    
    table {
      min-width: 500px;
    }
    
    th.feature-col {
      width: 150px;
    }
    
    .feature-name {
      padding-left: 0.75rem;
    }
    
    .category-row td {
      padding: 0.8rem 0.6rem;
    }
    
    .feature-row td {
      padding: 0.35rem 0.6rem;
    }
  }
</style>
